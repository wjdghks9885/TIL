# Telegram으로 챗봇 만들기

>  어제는 Flask에게 바로 요청해서 웹을 만들었지만, 오늘은 telegram을 통해 Flask에게 요청하고 Flask 또한 telegram을 통해 응답한다.

---

#### 1. Telegram에서 챗봇 역할을 수행해 줄 놈 만들기

- telegram 검색창에 botfather라고 검색한다.

- 클릭 후 start 클릭한다.

- /newbot을 쳐서 새로운 봇을 생성하고 봇에게 이름을 지어준다.

- 그러면 내 이름도 설정 해달라한다.

- 그래서 쳤는데 Sorry가 뜨면 다시 /newbot부터 해야한다.

- 다른 사람들과 이름 중복되면 안되는 듯하다..

- 어쨌든 어찌저찌 만들어서 말을 걸면 아무 대답이없다.

- 대답을 하게 만들어보자. ~~어렵다~~

---

#### 2. Telegram api 이용하기

- 챗봇은 **telegram api**를 이용해 만들었다. [telegram api 사이트](https://core.telegram.org/api) 여기 가면 있다.

- 보통 api를 이용해 무언가를 할 때는 **token**값이 필요하다.

- 이걸 부여받고 코드에 넣는 것이다.

- 하지만 **token**을 공개적으로 넣어서 누군가 이 **token**을 사용하면 다른 사람이 나인 것 처럼 행동할 수 있다.
  - 악의적으로 이용당할 위험이 있다는 것이다.

- 그래서 이 **token**을 공개적으로 넣지 않고 숨겨서 쓰는 방법이 있다.

- `.env` 파일을 만들어 이 파일안에 **token**을 넣어주면 된다.
  - (예시 : `MY_TOKEN=r2j24gj209wgjejpfw33j9p`) 이런식으로 변수명은 대문자로 하고 토큰을 부여해주면 된다.
  - 또한 `=` 이거 앞뒤로 공백도 있으면 안된다.

---

#### 3. webhook 이용하기

> webhook이란 나밖에 못 쓰는 localhost를 다른 사람도 쓸 수 있게 url을 수정해주는 것이다. 챗봇을 나만 사용하는 것이 아니라 다른 사람들도 사용할 수 있게 해주는 기능이다.

- telegram api token을 부여받고, .env 파일에 저장까지 했으면, 챗봇을 Flask와 엮어야한다.
  - 엮으려면 **webhook**이라는 것을 이용해야 한다.

- 로컬에서 **ngrok**이란 것을 다운 받아서 **webhhok**을 했다. [ngrok 사이트](https://ngrok.com/)

- **-ngrok**을 다운 받아 가상환경폴더가 있는 곳에 둔다.

- 그리고나서 **webhook**코드를 짜야한다. 코드는 *telegram_bot* 폴더에 있다.

- 그 코드를 한번 실행해주어야 한다.

---

#### 4. 챗봇 기능 추가

- 웹훅까지 다 했으면 챗봇만드는 코드(app.py)에서 하고 싶은 것들을 다 하면 된다!

- 나는 naver api에서 *papago 번역기*와 *clova 닮은 유명인 찾기*를 했다.

- api는 아니지만 챗봇에게 `/로또` 라고 하면 로또번호 6개 랜덤으로 알려주는 기능도 만들었다.

- 다시 한번 자세한 코드는 *telegram_bot* 폴더에 app.py에 있다.

---

#### 5. 챗봇 server

- 내가 만든 챗봇을 나만 사용하는 것이 아니라 다른 사람들도 사용할 수 있다.

- 하지만 내 컴퓨터를 계속 켜놔야하고, 내 컴퓨터가 버티질 못 할 것이다.

- 그래서 **pythonanywhere**라는 곳을 이용한다. [pythonanywhere 사이트](https://www.pythonanywhere.com/)

- 서버 컴퓨터 마냥 사용할 수 있는 곳이다. ~~사용법은 사이트 가서 알아보자~~
  - 일단 무료이고 괜찮다.

- 그래서 나는 여기에 코드를 올리고 내 api token도 올려서 내가 컴퓨터를 꺼도 내가 만든 telegram 챗봇이 계속 대답을 한다.ㅎㅎ

1. 이용 방법은 먼저 위에 링크 걸어둔 **pythonanywhere** 사이트에 가서 회원가입을 하고 로그인을 한다.
2. 그 후 오른쪽 위에 **Web**을 눌러 내 Web주소를 하나 만든다.
   - Web주소 만들 때 Flask체크, Python 3.7을 체크한다.
3. 그리고나서 오른쪽 위에 **Files**를 누른다.
4. 왼쪽에 보이는 mysite에 들어가서 `flask_app.py`에 들어가 내가 로컬에서 작업한 app.py에 있는 코드를 복붙한다.
5. 저장 후 다시 mysite에서 **Enter new file 어쩌고**가 있을 것이다.
   - 여기에 `.env`를 쓰고 **New file** 클릭.
   - 그리고나서 `.env`에 들어가 내가 로컬에서 작업한 .env에 있는 코드(token들)를 복붙한다.
6. 저장 후 나와 이번엔 오른쪽 위에 **Consoles**를 누른다.
   - bash 클릭 후 기다린다.
   - bash창이 뜨면 `$ pip3 install --user bs4` 라고 친 후 `Enter` 를 누른다.
   - 작업이 끝난 것 같으면 나온다.
7. 이제 마지막이다. 다시 오른쪽 위에 **Web**을 눌러 들어간다.
   - 들어가면 `Reload 내 주소` 버튼이 있을 것이다. 이걸 누른다.
8. Reload까지 눌렀다면 이제 telegram으로 가서 내가 만든 챗봇에게 말을 걸어보자!

---

#### 기타

- 내 telegram 챗봇 이름은 **bobot**이다.

- **bo12bot**이라고 검색해서 나오는 **bobot**이 내 챗봇일 것이다.

- 챗봇 기능
  1. "/로또"라고 치면 로또번호 6개씩 5줄을 알려준다.(5천원 어치 ㅋㅋ)
  2. "/번역"쓰고 띄어쓰기 후 영어를 치면 뒤에 쓴 영어를 번역해준다.
  3. 사진을 올리면 닮은꼴 연예인을 알려주고 퍼센트까지 나온다.(안나올수도;)
  4. "안녕"을 치면 받아준다.
  5. "뭐해" 혹은 "뭐 해"라고 치면 또 받아준다.ㅋㅋ
  6. 이 외의 말을 하면 모두 동일한 대답이다. ~~궁금하면 gogo~~



